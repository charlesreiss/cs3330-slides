\begin{frame}<1>[fragile,label=matrixMultLocalityEx]{which is better?}
\[ C_{ij} = \sum_{k=1}^n A_{ik}\times B_{kj} \]
\lstset{
    style=smaller,
    language=C,
    moredelim=**[is][\btHL<2>]{~2}{~},
    moredelim=**[is][\btHL<3>]{~3}{~},
    moredelim=**[is][\btHL<4>]{~4}{~},
}
\begin{lstlisting}
/* version 1: inner loop is k, middle is j*/
for (int i = 0; i < N; ++i)
  for (int j = 0; j < N; ++j)
    for (int k = 0; k < N; ++k)
      ~2C[i*N+j]~ += A[i * N + k] * B[k * N + j];

/* version 2: outer loop is k, middle is i */
for (int k = 0; k < N; ++k)
  for (int i = 0; i < N; ++i)
    for (int j = 0; j < N; ++j)
      C[i*N+j] += ~2A[i * N + k]~ * B[k * N + j];
\end{lstlisting}
exercise: Which version has better spatial/temporal locality for\ldots \\
\ldots accesses to C?
\ldots accesses to A?
\ldots accesses to B?
\end{frame}
