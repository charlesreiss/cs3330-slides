\graphicspath{{./figures/}}
\title{pipelining}
\date{}
\usepackage{pgfplots}
\begin{document}
\usepgflibrary{shapes.gates.logic.mux}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{calc,chains,shapes.misc,shapes.callouts,shapes.geometric,shapes.gates.logic.US,circuits.logic.US}
\input{../common/y86Util}
\input{../pipe/seqToPipeUtil}
\input{../pipe/pipeAddQTools}
\input{../pipe/pipePicUtils}
\input{../pipe/laundryTools}
\input{../pipe/countTools}

\begin{frame}
\titlepage
\end{frame}

\section{pipelining concept}

\subsection{example: laundry}

\input{../pipe/laundryPipeline}

\subsection{example: times three circuit}

% FIXME: modify to show ??? on input and output throughout

\subsubsection{without a pipeline}

\input{../pipe/countNoPipeline}

\subsubsection{with a pipeline; register tolerances}

\input{../pipe/countPipeline}

\subsubsection{register tolerances}

\input{../pipe/registerTolerance}

\subsubsection{exercise: timing}
\input{../pipe/countPipelineTiming}

\input{../pipe/deeperPipelineLib}

\section{deeper pipeline: diminishing returns}

\againframe<1-2>{deeperPipeline}

\subsection{preview: problems}

\againframe<9>{deeperPipeline}

\subsection{exercise: throughput now?}

\againframe<4-5>{deeperPipeline}

\subsection{generally}

\againframe<10>{deeperPipeline}

\input{../pipe/deeperPipelineDiminish}
    
\section{deeper pipeline: uneven returns}

\againframe<11>{deeperPipeline}

\againframe<6>{deeperPipeline}

\subsection{exercise: throughput now?}

\againframe<7-8>{deeperPipeline}

\subsection{generally}

\input{../pipe/deeperPipelineUneven}
    
    % FIXME: split out exercise for computing uneven cycle time
 
\section{revisiting SEQ stages for pipelining}

\input{../pipe/seqToPipeStages}

\section{pipelining addq}

\subsection{starting sequential; stages}

\input{../pipe/seqAddQStages}

\subsection{dividing stages with registers}

\input{../pipe/pipeAddQIntro}

\subsection{determining performance: critical paths}

\input{../pipe/criticalPaths}

\subsection{example execution timing}

\input{../pipe/pipeAddQTiming}

\subsection{exercise}
\input{../pipe/pipeAddQTimingEx}

\section{pipelining in HCL}

\subsection{book's naming of pipeline registers}

\input{../pipe/pipeNaming}

\subsection{pipelined addq in HCL}

\input{../pipe/addqHcl}

\section{tackling the whole processor}

\subsection{overall idea}

\input{../pipe/seqToPipeSimple}

\subsection{don't mix the stages}

\input{../pipe/controlRule}

\input{../pipe/memoryRW}

\section{data hazards}

\subsection{data hazard in addq}
\input{../pipe/addqhazard}

\subsection{solving addq hazard with stalling}
\input{../pipe/addqhazardstall}

\subsection{interlude: hazards versus dependencies}
\input{../pipe/hazardvdep}

\section{exercise: data hazard find/resolve}
\input{../pipe/hazardexercise}

\section{forwarding}
\subsection{why forwarding}
\input{../pipe/forwardwhy}

\subsection{logic to implement forwarding}
\input{../pipe/forwardlogic}

\subsection{exercise: forwarding conditions}
\input{../pipe/forwardcondquestion}

\subsection{aside: computing dste/etc. early}
\input{../pipe/seqtopipedsthilite}

\subsection{forwarding versus stalling}
\input{../pipe/forwardlogicdiag1}

\subsection{more forwarding paths?}
\input{../pipe/forwardlogictwostage}

\subsection{forwarding paths}
\input{../pipe/forwardpaths}  %xxx reg_outputb
% fixme: exercise

\subsection{forwarding paths exercise}
\input{../pipe/forwardpathsex}

\section{unsolved problem: the load/use hazard}
\input{../pipe/loadusehazard}

\section{control hazards}
\input{../pipe/controlhazard}

\subsection{forwarding paths exercise}
\input{../pipe/forwardPathsEx}


\section{unsolved problem: the load/use hazard}
\input{../pipe/loadUseHazard}

\section{a nit about missing forwarding}
\input{../pipe/loadToStoreFwd}

\subsection{aside: forwarding timings}
\begin{frame}{aside: forwarding timings}
    \begin{itemize}
    \item forwarding: adds MUXes for forwarding to critical path
        \begin{itemize}
        \item might slightly increase cycle time, considered acceptable
        \end{itemize}
    \item should not add much more to critical path:
        \begin{itemize}
        \item example: can't use value read from memory in ALU in same cycle
        \end{itemize}
    \end{itemize}
\end{frame}

\subsection{exercise: different hazards}
\input{../pipe/diffHazardEx}

\section{control hazards}
\input{../pipe/controlHazard}

\section{stalling costs}
\input{../pipe/hazardIssues}

\section{hazard v dependency exercises}
\subsection{exercise 2}
\input{../pipe/hazardVDepEx2}

\section{branch prediction}
\subsection{overview}
\input{../pipe/predIntro}

% FIXME: consider turning this into exercise (with nicer numbers)
\subsection{performance after prediction}
\input{../pipe/predEffect}


\section{HCLRS support for prediction/stalling}
\input{../pipe/stallLogic}
\input{../pipe/bubbleLogic}
\input{../pipe/hclrsBubbleStallBuiltIn}

\subsection{bubble/stall exercise (1)}
\input{../pipe/bubbleStallEx}

\subsection{bubble/stall exercise (2)}
\input{../pipe/squashStallEx}

\section{implementing prediction + stalling}

\subsection{overview}
\input{../pipe/stallSquashPieces}

\subsection{pipeline registers during stall}
\input{../pipe/stallPipelineDiagBubbleRepeat}

\subsection{bubbling on jump misprediction}
\input{../pipe/jumpMispredBubblePipeDiag}

\subsection{signals for jXX squash}
\input{../pipe/predSquash}

\subsection{bubbling on ret}
\input{../pipe/retBubblePipeDiag}


\subsection{signals for ret/stall}
\input{../pipe/retStallDetail}

\subsection{ret stall in HCL}
\input{../pipe/retStallHCL}

\subsection{PC update with jmp/etc.}
\input{../pipe/pcUpdate}

\section{overall CPU}
\input{../pipe/overallCpu}


\section{backup slides}
\begin{frame}{backup slides}
\end{frame}

\subsection{example execution timing}
\input{../pipe/pipeaddqtiming}

\subsection{jmp hazard with stalling}
\input{../pipe/jmpstall}

\subsection{ret hazard with stalling}
\input{../pipe/retstall}

\subsection{pc update logic [rearranging]}
\input{../pipe/pcupdaterearr}

\subsection{repeat same logic}
\input{../pipe/stalllogic}

\subsection{dependency hazard exercise 1}
\input{../pipe/hazardvdepex}

\subsection{timing exericse}
\input{../pipe/timingExericse}
\end{document}
